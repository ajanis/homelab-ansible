<!doctype html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>cephadm-ansible v2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />

    <link rel="stylesheet" href="_static/custom.css" type="text/css" />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=0.9, maximum-scale=0.9"
    />
  </head>
  <body>
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            <nav class="contents" id="contents" role="doc-toc">
              <p class="topic-title">Contents</p>
              <ul class="simple">
                <li>
                  <p>
                    <a class="reference internal" href="#introduction" id="id11"
                      >Introduction</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a class="reference internal" href="#terminology" id="id12"
                      >Terminology</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#ansible-inventory"
                      id="id13"
                      >Ansible inventory</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a class="reference internal" href="#playbooks" id="id14"
                      >Playbooks</a
                    >
                  </p>
                  <ul>
                    <li>
                      <p>
                        <a
                          class="reference internal"
                          href="#cephadm-preflight"
                          id="id15"
                          >cephadm-preflight</a
                        >
                      </p>
                      <ul>
                        <li>
                          <p>
                            <a
                              class="reference internal"
                              href="#options"
                              id="id16"
                              >Options</a
                            >
                          </p>
                          <ul>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#ceph-origin"
                                  id="id17"
                                  >ceph_origin</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#ceph-stable-key"
                                  id="id18"
                                  >ceph_stable_key</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#ceph-release"
                                  id="id19"
                                  >ceph_release</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#ceph-dev-branch"
                                  id="id20"
                                  >ceph_dev_branch</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#ceph-dev-sha1"
                                  id="id21"
                                  >ceph_dev_sha1</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#custom-repo-url"
                                  id="id22"
                                  >custom_repo_url</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#ceph-custom-repositories"
                                  id="id23"
                                  >ceph_custom_repositories</a
                                >
                              </p>
                              <ul>
                                <li>
                                  <p>
                                    <a
                                      class="reference internal"
                                      href="#name"
                                      id="id24"
                                      >name</a
                                    >
                                  </p>
                                </li>
                                <li>
                                  <p>
                                    <a
                                      class="reference internal"
                                      href="#gpgkey"
                                      id="id25"
                                      >gpgkey</a
                                    >
                                  </p>
                                </li>
                                <li>
                                  <p>
                                    <a
                                      class="reference internal"
                                      href="#gpgcheck"
                                      id="id26"
                                      >gpgcheck</a
                                    >
                                  </p>
                                </li>
                                <li>
                                  <p>
                                    <a
                                      class="reference internal"
                                      href="#state"
                                      id="id27"
                                      >state</a
                                    >
                                  </p>
                                </li>
                                <li>
                                  <p>
                                    <a
                                      class="reference internal"
                                      href="#description"
                                      id="id28"
                                      >description</a
                                    >
                                  </p>
                                </li>
                                <li>
                                  <p>
                                    <a
                                      class="reference internal"
                                      href="#baseurl"
                                      id="id29"
                                      >baseurl</a
                                    >
                                  </p>
                                </li>
                                <li>
                                  <p>
                                    <a
                                      class="reference internal"
                                      href="#file"
                                      id="id30"
                                      >file</a
                                    >
                                  </p>
                                </li>
                                <li>
                                  <p>
                                    <a
                                      class="reference internal"
                                      href="#priority"
                                      id="id31"
                                      >priority</a
                                    >
                                  </p>
                                </li>
                                <li>
                                  <p>
                                    <a
                                      class="reference internal"
                                      href="#components"
                                      id="id32"
                                      >components</a
                                    >
                                  </p>
                                </li>
                              </ul>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#set-insecure-registries"
                                  id="id33"
                                  >set_insecure_registries</a
                                >
                              </p>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <p>
                        <a
                          class="reference internal"
                          href="#cephadm-set-container-insecure-registries"
                          id="id34"
                          >cephadm-set-container-insecure-registries</a
                        >
                      </p>
                      <ul>
                        <li>
                          <p>
                            <a class="reference internal" href="#id2" id="id35"
                              >Options</a
                            >
                          </p>
                          <ul>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#insecure-registry"
                                  id="id36"
                                  >insecure_registry</a
                                >
                              </p>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <p>
                        <a
                          class="reference internal"
                          href="#cephadm-distribute-ssh-key"
                          id="id37"
                          >cephadm-distribute-ssh-key</a
                        >
                      </p>
                      <ul>
                        <li>
                          <p>
                            <a class="reference internal" href="#id3" id="id38"
                              >Options</a
                            >
                          </p>
                          <ul>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#fsid"
                                  id="id39"
                                  >fsid</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#admin-node"
                                  id="id40"
                                  >admin_node</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#cephadm-ssh-user"
                                  id="id41"
                                  >cephadm_ssh_user</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#cephadm-pubkey-path"
                                  id="id42"
                                  >cephadm_pubkey_path</a
                                >
                              </p>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <p>
                        <a
                          class="reference internal"
                          href="#cephadm-purge"
                          id="id43"
                          >cephadm-purge</a
                        >
                      </p>
                      <ul>
                        <li>
                          <p>
                            <a class="reference internal" href="#id4" id="id44"
                              >Options</a
                            >
                          </p>
                          <ul>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#id5"
                                  id="id45"
                                  >fsid</a
                                >
                              </p>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <p>
                        <a
                          class="reference internal"
                          href="#cephadm-clients"
                          id="id46"
                          >cephadm-clients</a
                        >
                      </p>
                      <ul>
                        <li>
                          <p>
                            <a class="reference internal" href="#id6" id="id47"
                              >Options</a
                            >
                          </p>
                          <ul>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#keyring"
                                  id="id48"
                                  >keyring</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#conf"
                                  id="id49"
                                  >conf</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#keyring-dest"
                                  id="id50"
                                  >keyring_dest</a
                                >
                              </p>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <p>
                        <a
                          class="reference internal"
                          href="#rocksdb-resharding"
                          id="id51"
                          >rocksdb-resharding</a
                        >
                      </p>
                      <ul>
                        <li>
                          <p>
                            <a class="reference internal" href="#id7" id="id52"
                              >Options</a
                            >
                          </p>
                          <ul>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#id8"
                                  id="id53"
                                  >fsid</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#osd-id"
                                  id="id54"
                                  >osd_id</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#id9"
                                  id="id55"
                                  >admin_node</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#rocksdb-sharding-parameters"
                                  id="id56"
                                  >rocksdb_sharding_parameters</a
                                >
                              </p>
                            </li>
                            <li>
                              <p>
                                <a
                                  class="reference internal"
                                  href="#docker"
                                  id="id57"
                                  >docker</a
                                >
                              </p>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li>
                  <p>
                    <a class="reference internal" href="#modules" id="id58"
                      >Modules</a
                    >
                  </p>
                  <ul>
                    <li>
                      <p>
                        <a class="reference internal" href="#id10" id="id59"
                          >Introduction</a
                        >
                      </p>
                    </li>
                    <li>
                      <p>
                        <a
                          class="reference internal"
                          href="#module-descriptions"
                          id="id60"
                          >Module descriptions</a
                        >
                      </p>
                      <ul>
                        <li>
                          <p>
                            <a
                              class="reference internal"
                              href="#cephadm-bootstrap"
                              id="id61"
                              >cephadm_bootstrap</a
                            >
                          </p>
                        </li>
                        <li>
                          <p>
                            <a
                              class="reference internal"
                              href="#ceph-orch-host"
                              id="id62"
                              >ceph_orch_host</a
                            >
                          </p>
                        </li>
                        <li>
                          <p>
                            <a
                              class="reference internal"
                              href="#ceph-config"
                              id="id63"
                              >ceph_config</a
                            >
                          </p>
                        </li>
                        <li>
                          <p>
                            <a
                              class="reference internal"
                              href="#ceph-orch-apply"
                              id="id64"
                              >ceph_orch_apply</a
                            >
                          </p>
                        </li>
                        <li>
                          <p>
                            <a
                              class="reference internal"
                              href="#ceph-orch-daemon"
                              id="id65"
                              >ceph_orch_daemon</a
                            >
                          </p>
                        </li>
                        <li>
                          <p>
                            <a
                              class="reference internal"
                              href="#cephadm-registry-login"
                              id="id66"
                              >cephadm_registry_login</a
                            >
                          </p>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <p>
                        <a class="reference internal" href="#samples" id="id67"
                          >Samples</a
                        >
                      </p>
                    </li>
                  </ul>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#upcoming-changes"
                      id="id68"
                      >Upcoming changes</a
                    >
                  </p>
                </li>
              </ul>
            </nav>
            <section id="introduction">
              <h1>
                <a class="toc-backref" href="#id11" role="doc-backlink"
                  >Introduction</a
                ><a
                  class="headerlink"
                  href="#introduction"
                  title="Link to this heading"
                  >¶</a
                >
              </h1>
              <p>
                cephadm-ansible is a collection of Ansible modules and playbooks
                to simplify workflows that are not covered by
                <a class="reference internal" href="#cephadm" id="id1"
                  ><span>[cephadm]</span></a
                >. They are covered by the following playbooks:
              </p>
              <ul class="simple">
                <li>
                  <p>
                    cephadm-preflight.yml: Initial setup of hosts before
                    bootstrapping the cluster
                  </p>
                </li>
                <li><p>cephadm-clients.yml: Setting up client hosts</p></li>
                <li><p>cephadm-purge-cluster.yml: Remove a Ceph cluster</p></li>
                <li>
                  <p>
                    cephadm-distribute-ssh-key.yml: Distribute a SSH public key
                    to all hosts
                  </p>
                </li>
                <li>
                  <p>
                    cephadm-set-container-insecure-registries.yml: Add a block
                    in /etc/containers/registries.conf to add an insecure
                    registry
                  </p>
                </li>
              </ul>
              <p>
                Additionnally, several ansible modules are provided in order to
                let people writing their own playbooks.
              </p>
              <div role="list" class="citation-list">
                <div class="citation" id="cephadm" role="doc-biblioentry">
                  <span class="label"
                    ><span class="fn-bracket">[</span
                    ><a role="doc-backlink" href="#id1">cephadm</a
                    ><span class="fn-bracket">]</span></span
                  >
                  <p>
                    <a
                      class="reference external"
                      href="https://docs.ceph.com/en/latest/cephadm/"
                      >https://docs.ceph.com/en/latest/cephadm/</a
                    >
                  </p>
                </div>
              </div>
            </section>
            <section id="terminology">
              <h1>
                <a class="toc-backref" href="#id12" role="doc-backlink"
                  >Terminology</a
                ><a
                  class="headerlink"
                  href="#terminology"
                  title="Link to this heading"
                  >¶</a
                >
              </h1>
              <dl class="simple">
                <dt><strong>admin host</strong></dt>
                <dd>
                  <p>
                    A host where the admin keyring and ceph config file are
                    present. Although the admin host and the bootstrap host are
                    usually the same host, it is possible to have multiple admin
                    hosts later.
                    <code class="docutils literal notranslate"
                      ><span class="pre">cephadm</span></code
                    >
                    will make a host become ‘admin’ when the label
                    <code class="docutils literal notranslate"
                      ><span class="pre">_admin</span></code
                    >
                    is added to that host. (ie:
                    <code class="docutils literal notranslate"
                      ><span class="pre">ceph</span>
                      <span class="pre">orch</span>
                      <span class="pre">host</span>
                      <span class="pre">label</span>
                      <span class="pre">add</span>
                      <span class="pre">&lt;host&gt;</span>
                      <span class="pre">_admin</span></code
                    >). This hosts should be present in the group
                    <code class="docutils literal notranslate"
                      ><span class="pre">[admin]</span></code
                    >
                    in the ansible inventory. If for some reason you decide a
                    host shouldn’t be a ‘admin host’ anymore, you have to :
                  </p>
                  <ul class="simple">
                    <li>
                      <p>
                        remove it from the group
                        <code class="docutils literal notranslate"
                          ><span class="pre">[admin]</span></code
                        >
                        in the ansible inventory,
                      </p>
                    </li>
                    <li><p>remove the admin keyring,</p></li>
                    <li><p>remove the ceph config file,</p></li>
                    <li>
                      <p>
                        remove the
                        <code class="docutils literal notranslate"
                          ><span class="pre">_admin</span></code
                        >
                        label. (ie
                        <code class="docutils literal notranslate"
                          ><span class="pre">ceph</span>
                          <span class="pre">orch</span>
                          <span class="pre">host</span>
                          <span class="pre">label</span>
                          <span class="pre">rm</span>
                          <span class="pre">&lt;host&gt;</span>
                          <span class="pre">_admin</span></code
                        >)
                      </p>
                    </li>
                  </ul>
                </dd>
                <dt><strong>ansible host</strong></dt>
                <dd>
                  <p>The host where any cephadm-ansible playbook is run.</p>
                </dd>
                <dt><strong>bootstrap host</strong></dt>
                <dd>
                  <p>
                    The host where the ceph cluster will start. Unless you pass
                    the
                    <code class="docutils literal notranslate"
                      ><span class="pre">--skip-admin-label</span></code
                    >
                    option to the
                    <code class="docutils literal notranslate"
                      ><span class="pre">ceph</span>
                      <span class="pre">bootstram</span></code
                    >
                    command, this host will receive the admin keyring and the
                    ceph config file and should be considered as an ‘admin
                    host’. This host should be present in the group
                    <code class="docutils literal notranslate"
                      ><span class="pre">[admin]</span></code
                    >
                    in the ansible inventory.
                  </p>
                </dd>
              </dl>
            </section>
            <section id="ansible-inventory">
              <h1>
                <a class="toc-backref" href="#id13" role="doc-backlink"
                  >Ansible inventory</a
                ><a
                  class="headerlink"
                  href="#ansible-inventory"
                  title="Link to this heading"
                  >¶</a
                >
              </h1>
              <p>
                The ansible inventory is a file where all the hosts intended to
                be part of the ceph cluster will be listed. The most common
                format are INI or YAML.
              </p>
              <p>
                Although you probably want to keep it as simple as possible, you
                can organize your inventory and create groups,
                <cite>cephadm-ansible</cite> won’t differentiate except for the
                following requirements:
              </p>
              <ul class="simple">
                <li>
                  <p>
                    Client hosts must be defined in a dedicated group
                    <code class="docutils literal notranslate"
                      ><span class="pre">[clients]</span></code
                    >.
                  </p>
                </li>
                <li>
                  <p>
                    Both
                    <code class="docutils literal notranslate"
                      ><span class="pre">cephadm-purge-cluster.yml</span></code
                    >
                    and
                    <code class="docutils literal notranslate"
                      ><span class="pre">cephadm-clients.yml</span></code
                    >
                    playbooks require a group
                    <code class="docutils literal notranslate"
                      ><span class="pre">[admin]</span></code
                    >
                    with at least one admin host (usually it will be the
                    bootstrap node).
                  </p>
                </li>
              </ul>
              <div class="admonition note">
                <p class="admonition-title">Note</p>
                <p>
                  the name of the client group can be changed. In that case you
                  have to set the variable <cite>client_group</cite>.
                </p>
              </div>
              <p>
                Otherwise, you can create groups such as
                <code class="docutils literal notranslate"
                  ><span class="pre">[monitors]</span></code
                >,
                <code class="docutils literal notranslate"
                  ><span class="pre">[osds]</span></code
                >,
                <code class="docutils literal notranslate"
                  ><span class="pre">[rgws]</span></code
                >, that might help you keep clarity in your inventory file and
                ease the
                <code class="docutils literal notranslate"
                  ><span class="pre">--limit</span></code
                >
                usage if you plan to use it to target specific a group of hosts
                only.
              </p>
              <p>A basic inventory would look like following:</p>
              <div class="highlight-default notranslate">
                <div class="highlight">
                  <pre><span></span><span class="c1"># cat hosts</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">mon1</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">mon2</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">mon3</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">osd1</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">osd2</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">osd3</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">mds1</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">mds2</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">rgw1</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">rgw2</span>

<span class="p">[</span><span class="n">clients</span><span class="p">]</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">client1</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">client2</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">client3</span>

<span class="p">[</span><span class="n">admin</span><span class="p">]</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">mon1</span>
</pre>
                </div>
              </div>
            </section>
            <section id="playbooks">
              <h1>
                <a class="toc-backref" href="#id14" role="doc-backlink"
                  >Playbooks</a
                ><a
                  class="headerlink"
                  href="#playbooks"
                  title="Link to this heading"
                  >¶</a
                >
              </h1>
              <section id="cephadm-preflight">
                <h2>
                  <a class="toc-backref" href="#id15" role="doc-backlink"
                    >cephadm-preflight</a
                  ><a
                    class="headerlink"
                    href="#cephadm-preflight"
                    title="Link to this heading"
                    >¶</a
                  >
                </h2>
                <p>
                  This playbook configures the Ceph repository. It also installs
                  some prerequisites (podman, lvm2, chronyd, cephadm, …)
                </p>
                <p>Usage:</p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">inventory</span> <span class="n">host</span> <span class="n">file</span><span class="o">&gt;</span> <span class="n">cephadm</span><span class="o">-</span><span class="n">preflight</span><span class="o">.</span><span class="n">yml</span>
</pre>
                  </div>
                </div>
                <p>
                  You can limit the execution to a set of hosts by using
                  <code class="docutils literal notranslate"
                    ><span class="pre">--limit</span></code
                  >
                  option:
                </p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">inventory</span> <span class="n">host</span> <span class="n">file</span><span class="o">&gt;</span> <span class="n">cephadm</span><span class="o">-</span><span class="n">preflight</span><span class="o">.</span><span class="n">yml</span> <span class="o">--</span><span class="n">limit</span> <span class="o">&lt;</span><span class="n">my_osd_group</span><span class="o">|</span><span class="n">my_node_name</span><span class="o">&gt;</span>
</pre>
                  </div>
                </div>
                <p>
                  You can override variables using
                  <code class="docutils literal notranslate"
                    ><span class="pre">--extra-vars</span></code
                  >
                  parameter:
                </p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">inventory</span> <span class="n">host</span> <span class="n">file</span><span class="o">&gt;</span> <span class="n">cephadm</span><span class="o">-</span><span class="n">preflight</span><span class="o">.</span><span class="n">yml</span> <span class="o">--</span><span class="n">extra</span><span class="o">-</span><span class="nb">vars</span> <span class="s2">&quot;ceph_origin=rhcs&quot;</span>
</pre>
                  </div>
                </div>
                <section id="options">
                  <h3>
                    <a class="toc-backref" href="#id16" role="doc-backlink"
                      >Options</a
                    ><a
                      class="headerlink"
                      href="#options"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <section id="ceph-origin">
                    <h4>
                      <a class="toc-backref" href="#id17" role="doc-backlink"
                        >ceph_origin</a
                      ><a
                        class="headerlink"
                        href="#ceph-origin"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd><p>The source of Ceph repositories.</p></dd>
                    </dl>
                    <p><strong>valid values</strong></p>
                    <dl>
                      <dt>
                        <code class="docutils literal notranslate"
                          ><span class="pre">rhcs</span></code
                        >
                      </dt>
                      <dd><p>Repository from Red Hat Ceph Storage.</p></dd>
                      <dt>
                        <code class="docutils literal notranslate"
                          ><span class="pre">community</span></code
                        >
                      </dt>
                      <dd>
                        <p>
                          Community repository (<a
                            class="reference external"
                            href="https://download.ceph.com"
                            >https://download.ceph.com</a
                          >)
                        </p>
                      </dd>
                      <dt>
                        <code class="docutils literal notranslate"
                          ><span class="pre">custom</span></code
                        >
                      </dt>
                      <dd>
                        <p>
                          Custom repository. When
                          <code class="docutils literal notranslate"
                            ><span class="pre">ceph_origin:</span>
                            <span class="pre">custom</span></code
                          >
                          is defined, you have to set the variable
                          <code class="docutils literal notranslate"
                            ><span class="pre">custom_repo_url</span></code
                          >
                          with the URL of your repository. Passing the extra-var
                          <code class="docutils literal notranslate"
                            ><span class="pre">-e</span>
                            <span class="pre"
                              >custom_repo_state=absent</span
                            ></code
                          >
                          allows you to remove this repository later.
                        </p>
                        <p>
                          It also supports deploying multiple repositories, in
                          that case you must set the variable
                          <code class="docutils literal notranslate"
                            ><span class="pre"
                              >ceph_custom_repositories</span
                            ></code
                          >
                          instead.
                          <code class="docutils literal notranslate"
                            ><span class="pre"
                              >ceph_custom_repositories</span
                            ></code
                          >
                          is a dictionnary that should look like following:
                        </p>
                        <div class="highlight-default notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="n">ceph_custom_repositories</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">ceph_custom_noarch</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">present</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Ceph</span> <span class="n">custom</span> <span class="n">repo</span> <span class="n">noarch</span>
    <span class="n">gpgcheck</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
    <span class="n">baseurl</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">4.</span><span class="n">chacra</span><span class="o">.</span><span class="n">ceph</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">r</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">cf17ed16c3964b635e9b6c22e607ea5672341c5c</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="mi">8</span><span class="o">/</span><span class="n">flavors</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">noarch</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">ceph_shaman_build_noarch</span>
    <span class="n">priority</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="mi">1</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">ceph_custom_x86_64</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">present</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Ceph</span> <span class="n">custom</span> <span class="n">repo</span> <span class="n">x86_64</span>
    <span class="n">gpgcheck</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
    <span class="n">baseurl</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">4.</span><span class="n">chacra</span><span class="o">.</span><span class="n">ceph</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">r</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">cf17ed16c3964b635e9b6c22e607ea5672341c5c</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="mi">8</span><span class="o">/</span><span class="n">flavors</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">x86_64</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">ceph_shaman_build_x86_64</span>
    <span class="n">priority</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="mi">1</span>
</pre>
                          </div>
                        </div>
                        <p>
                          Given that the definition is more complex, you might
                          want to define it as a group_vars/host_vars rather
                          than as an extra-var:
                        </p>
                        <div class="highlight-default notranslate">
                          <div class="highlight">
                            <pre><span></span>$ cat group_vars/all
---
ceph_custom_repositories:
  - name: ceph_custom_noarch
    state: present
    description: Ceph custom repo noarch
    gpgcheck: &#39;no&#39;
    baseurl: https://4.chacra.ceph.com/r/ceph/main/cf17ed16c3964b635e9b6c22e607ea5672341c5c/centos/8/flavors/default/noarch
    file: ceph_shaman_build_noarch
    priority: &#39;2&#39;
    enabled: 1
  - name: ceph_custom_x86_64
    state: present
    description: Ceph custom repo x86_64
    gpgcheck: &#39;no&#39;
    baseurl: https://4.chacra.ceph.com/r/ceph/main/cf17ed16c3964b635e9b6c22e607ea5672341c5c/centos/8/flavors/default/x86_64
    file: ceph_shaman_build_x86_64
    priority: &#39;2&#39;
    enabled: 1
</pre>
                          </div>
                        </div>
                      </dd>
                      <dt>
                        <code class="docutils literal notranslate"
                          ><span class="pre">shaman</span></code
                        >
                      </dt>
                      <dd><p>Devel repository.</p></dd>
                      <dt><strong>default</strong></dt>
                      <dd><p>“community”</p></dd>
                    </dl>
                  </section>
                  <section id="ceph-stable-key">
                    <h4>
                      <a class="toc-backref" href="#id18" role="doc-backlink"
                        >ceph_stable_key</a
                      ><a
                        class="headerlink"
                        href="#ceph-stable-key"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd><p>URL to the gpg key.</p></dd>
                      <dt><strong>default</strong></dt>
                      <dd>
                        <p>
                          <a
                            class="reference external"
                            href="https://download.ceph.com/keys/release.asc"
                            >https://download.ceph.com/keys/release.asc</a
                          >
                        </p>
                      </dd>
                    </dl>
                  </section>
                  <section id="ceph-release">
                    <h4>
                      <a class="toc-backref" href="#id19" role="doc-backlink"
                        >ceph_release</a
                      ><a
                        class="headerlink"
                        href="#ceph-release"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd><p>The release of Ceph.</p></dd>
                      <dt><strong>default</strong></dt>
                      <dd><p>Corresponding Ceph release.</p></dd>
                    </dl>
                  </section>
                  <section id="ceph-dev-branch">
                    <h4>
                      <a class="toc-backref" href="#id20" role="doc-backlink"
                        >ceph_dev_branch</a
                      ><a
                        class="headerlink"
                        href="#ceph-dev-branch"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The development branch to be used in shaman when
                          <cite>ceph_origin</cite> is ‘shaman’.
                        </p>
                      </dd>
                      <dt><strong>default</strong></dt>
                      <dd><p>“main”</p></dd>
                    </dl>
                  </section>
                  <section id="ceph-dev-sha1">
                    <h4>
                      <a class="toc-backref" href="#id21" role="doc-backlink"
                        >ceph_dev_sha1</a
                      ><a
                        class="headerlink"
                        href="#ceph-dev-sha1"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The sha1 corresponding to the build to be used when
                          <cite>ceph_origin</cite> is ‘shaman’.
                        </p>
                      </dd>
                      <dt><strong>default</strong></dt>
                      <dd><p>“latest”</p></dd>
                    </dl>
                  </section>
                  <section id="custom-repo-url">
                    <h4>
                      <a class="toc-backref" href="#id22" role="doc-backlink"
                        >custom_repo_url</a
                      ><a
                        class="headerlink"
                        href="#custom-repo-url"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The url of the repository when
                          <code class="docutils literal notranslate"
                            ><span class="pre">ceph_origin</span></code
                          >
                          is ‘custom’. Mutually exclusive with
                          <code class="docutils literal notranslate"
                            ><span class="pre"
                              >ceph_custom_repositories</span
                            ></code
                          >.
                        </p>
                      </dd>
                    </dl>
                  </section>
                  <section id="ceph-custom-repositories">
                    <h4>
                      <a class="toc-backref" href="#id23" role="doc-backlink"
                        >ceph_custom_repositories</a
                      ><a
                        class="headerlink"
                        href="#ceph-custom-repositories"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <p>
                      This variable is a list. Mutually exclusive with
                      <code class="docutils literal notranslate"
                        ><span class="pre">custom_repo_url</span></code
                      >. The following options can be specified for each element
                      that represents a repository to be set up:
                    </p>
                    <section id="name">
                      <h5>
                        <a class="toc-backref" href="#id24" role="doc-backlink"
                          >name</a
                        ><a
                          class="headerlink"
                          href="#name"
                          title="Link to this heading"
                          >¶</a
                        >
                      </h5>
                      <dl class="simple">
                        <dt><strong>description</strong></dt>
                        <dd><p>The name of the repository.</p></dd>
                      </dl>
                    </section>
                    <section id="gpgkey">
                      <h5>
                        <a class="toc-backref" href="#id25" role="doc-backlink"
                          >gpgkey</a
                        ><a
                          class="headerlink"
                          href="#gpgkey"
                          title="Link to this heading"
                          >¶</a
                        >
                      </h5>
                      <dl class="simple">
                        <dt><strong>description</strong></dt>
                        <dd>
                          <p>
                            The url of the gpg key corresponding to the
                            repository being set up.
                          </p>
                        </dd>
                      </dl>
                    </section>
                    <section id="gpgcheck">
                      <h5>
                        <a class="toc-backref" href="#id26" role="doc-backlink"
                          >gpgcheck</a
                        ><a
                          class="headerlink"
                          href="#gpgcheck"
                          title="Link to this heading"
                          >¶</a
                        >
                      </h5>
                      <dl class="simple">
                        <dt><strong>description</strong></dt>
                        <dd><p>Whether gpgcheck has to be performed.</p></dd>
                      </dl>
                    </section>
                    <section id="state">
                      <h5>
                        <a class="toc-backref" href="#id27" role="doc-backlink"
                          >state</a
                        ><a
                          class="headerlink"
                          href="#state"
                          title="Link to this heading"
                          >¶</a
                        >
                      </h5>
                      <dl class="simple">
                        <dt><strong>description</strong></dt>
                        <dd>
                          <p>
                            Whether this repository has to be present or absent.
                            (Default: present)
                          </p>
                        </dd>
                      </dl>
                    </section>
                    <section id="description">
                      <h5>
                        <a class="toc-backref" href="#id28" role="doc-backlink"
                          >description</a
                        ><a
                          class="headerlink"
                          href="#description"
                          title="Link to this heading"
                          >¶</a
                        >
                      </h5>
                      <dl class="simple">
                        <dt><strong>description</strong></dt>
                        <dd><p>A short repository description</p></dd>
                      </dl>
                    </section>
                    <section id="baseurl">
                      <h5>
                        <a class="toc-backref" href="#id29" role="doc-backlink"
                          >baseurl</a
                        ><a
                          class="headerlink"
                          href="#baseurl"
                          title="Link to this heading"
                          >¶</a
                        >
                      </h5>
                      <dl class="simple">
                        <dt><strong>description</strong></dt>
                        <dd>
                          <p>
                            The url of the repository pointing to the location
                            where ‘repodata’ directory lives.
                          </p>
                        </dd>
                      </dl>
                    </section>
                    <section id="file">
                      <h5>
                        <a class="toc-backref" href="#id30" role="doc-backlink"
                          >file</a
                        ><a
                          class="headerlink"
                          href="#file"
                          title="Link to this heading"
                          >¶</a
                        >
                      </h5>
                      <dl class="simple">
                        <dt><strong>description</strong></dt>
                        <dd>
                          <p>
                            The filename Ansible will use to write the
                            repository file.
                          </p>
                        </dd>
                      </dl>
                    </section>
                    <section id="priority">
                      <h5>
                        <a class="toc-backref" href="#id31" role="doc-backlink"
                          >priority</a
                        ><a
                          class="headerlink"
                          href="#priority"
                          title="Link to this heading"
                          >¶</a
                        >
                      </h5>
                      <dl class="simple">
                        <dt><strong>description</strong></dt>
                        <dd><p>The priority of this repository.</p></dd>
                      </dl>
                    </section>
                    <section id="components">
                      <h5>
                        <a class="toc-backref" href="#id32" role="doc-backlink"
                          >components</a
                        ><a
                          class="headerlink"
                          href="#components"
                          title="Link to this heading"
                          >¶</a
                        >
                      </h5>
                      <dl class="simple">
                        <dt><strong>description</strong></dt>
                        <dd>
                          <p>
                            This is a Debian OS-based family parameter only. The
                            components of this ubuntu/debian repository.
                          </p>
                        </dd>
                      </dl>
                      <p>Example:</p>
                      <div class="highlight-default notranslate">
                        <div class="highlight">
                          <pre><span></span><span class="n">ceph_custom_repositories</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">ceph_custom_noarch</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">present</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Ceph</span> <span class="n">custom</span> <span class="n">repo</span> <span class="n">noarch</span>
    <span class="n">gpgcheck</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
    <span class="n">baseurl</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">4.</span><span class="n">chacra</span><span class="o">.</span><span class="n">ceph</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">r</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">cf17ed16c3964b635e9b6c22e607ea5672341c5c</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="mi">8</span><span class="o">/</span><span class="n">flavors</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">noarch</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">ceph_shaman_build_noarch</span>
    <span class="n">priority</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">ceph_custom_x86_64</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">present</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Ceph</span> <span class="n">custom</span> <span class="n">repo</span> <span class="n">x86_64</span>
    <span class="n">gpgcheck</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
    <span class="n">baseurl</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">4.</span><span class="n">chacra</span><span class="o">.</span><span class="n">ceph</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">r</span><span class="o">/</span><span class="n">ceph</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">cf17ed16c3964b635e9b6c22e607ea5672341c5c</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="mi">8</span><span class="o">/</span><span class="n">flavors</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">x86_64</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">ceph_shaman_build_x86_64</span>
    <span class="n">priority</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span>
</pre>
                        </div>
                      </div>
                    </section>
                  </section>
                  <section id="set-insecure-registries">
                    <h4>
                      <a class="toc-backref" href="#id33" role="doc-backlink"
                        >set_insecure_registries</a
                      ><a
                        class="headerlink"
                        href="#set-insecure-registries"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          Whether
                          <code class="docutils literal notranslate"
                            ><span class="pre"
                              >cephadm-preflight.yml</span
                            ></code
                          >
                          playbook will call
                          <code class="docutils literal notranslate"
                            ><span class="pre"
                              >cephadm-set-container-insecure-registries.yml</span
                            ></code
                          >
                          to add an insecure registry in
                          <code class="docutils literal notranslate"
                            ><span class="pre"
                              >/etc/containers/registries.conf</span
                            ></code
                          >.
                          <code class="docutils literal notranslate"
                            ><span class="pre">insecure_registry</span></code
                          >
                          option must be passed (-e
                          insecure_registry=&lt;registry url&gt;)
                        </p>
                      </dd>
                      <dt><strong>default</strong></dt>
                      <dd><p>false</p></dd>
                    </dl>
                  </section>
                </section>
              </section>
              <section id="cephadm-set-container-insecure-registries">
                <h2>
                  <a class="toc-backref" href="#id34" role="doc-backlink"
                    >cephadm-set-container-insecure-registries</a
                  ><a
                    class="headerlink"
                    href="#cephadm-set-container-insecure-registries"
                    title="Link to this heading"
                    >¶</a
                  >
                </h2>
                <p>
                  This playbook adds a block in
                  <code class="docutils literal notranslate"
                    ><span class="pre"
                      >/etc/containers/registries.conf</span
                    ></code
                  >
                  in order to allow an insecure registry to be used.
                </p>
                <p>Usage:</p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">inventory</span> <span class="n">host</span> <span class="n">file</span><span class="o">&gt;</span> <span class="n">cephadm</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">insecure</span><span class="o">-</span><span class="n">registries</span><span class="o">.</span><span class="n">yml</span> <span class="o">-</span><span class="n">e</span> <span class="n">insecure_registry</span><span class="o">=&lt;</span><span class="n">registry</span> <span class="n">url</span><span class="o">&gt;</span>
</pre>
                  </div>
                </div>
                <section id="id2">
                  <h3>
                    <a class="toc-backref" href="#id35" role="doc-backlink"
                      >Options</a
                    ><a
                      class="headerlink"
                      href="#id2"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <section id="insecure-registry">
                    <h4>
                      <a class="toc-backref" href="#id36" role="doc-backlink"
                        >insecure_registry</a
                      ><a
                        class="headerlink"
                        href="#insecure-registry"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The address of the insecure registry to be added to
                          <code class="docutils literal notranslate"
                            ><span class="pre"
                              >/etc/containers/registries.conf</span
                            ></code
                          >.
                        </p>
                      </dd>
                      <dt><strong>default</strong></dt>
                      <dd><p>No default.</p></dd>
                    </dl>
                  </section>
                </section>
              </section>
              <section id="cephadm-distribute-ssh-key">
                <h2>
                  <a class="toc-backref" href="#id37" role="doc-backlink"
                    >cephadm-distribute-ssh-key</a
                  ><a
                    class="headerlink"
                    href="#cephadm-distribute-ssh-key"
                    title="Link to this heading"
                    >¶</a
                  >
                </h2>
                <p>
                  This playbook distributes an SSH public key over all hosts
                  present in the inventory. The key to be copied will be read
                  from a file specified at the path defined in
                  <code class="docutils literal notranslate"
                    ><span class="pre">cephadm_pubkey_path</span></code
                  >
                  <strong>from the Ansible controller host</strong>. If
                  <code class="docutils literal notranslate"
                    ><span class="pre">cephadm_pubkey_path</span></code
                  >
                  is unset, the playbook will assume it is supposed to get it
                  from the command
                  <code class="docutils literal notranslate"
                    ><span class="pre">cephadm</span>
                    <span class="pre">get-pub-key</span></code
                  >.
                </p>
                <p>Usage:</p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">inventory</span> <span class="n">host</span> <span class="n">file</span><span class="o">&gt;</span> <span class="n">cephadm</span><span class="o">-</span><span class="n">distribute</span><span class="o">-</span><span class="n">ssh</span><span class="o">-</span><span class="n">key</span><span class="o">.</span><span class="n">yml</span> <span class="o">-</span><span class="n">e</span> <span class="n">admin_node</span><span class="o">=</span><span class="n">ceph</span><span class="o">-</span><span class="n">node01</span> <span class="o">-</span><span class="n">e</span> <span class="n">cephadm_pubkey_path</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">cephadm</span><span class="o">/</span><span class="n">ceph</span><span class="o">.</span><span class="n">key</span>
</pre>
                  </div>
                </div>
                <section id="id3">
                  <h3>
                    <a class="toc-backref" href="#id38" role="doc-backlink"
                      >Options</a
                    ><a
                      class="headerlink"
                      href="#id3"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <section id="fsid">
                    <h4>
                      <a class="toc-backref" href="#id39" role="doc-backlink"
                        >fsid</a
                      ><a
                        class="headerlink"
                        href="#fsid"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd><p>The fsid of the Ceph cluster.</p></dd>
                    </dl>
                  </section>
                  <section id="admin-node">
                    <h4>
                      <a class="toc-backref" href="#id40" role="doc-backlink"
                        >admin_node</a
                      ><a
                        class="headerlink"
                        href="#admin-node"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The name of a node with enough privileges to call
                          <cite>cephadm get-pub-key</cite> command. (usually the
                          bootstrap node).
                        </p>
                      </dd>
                    </dl>
                  </section>
                  <section id="cephadm-ssh-user">
                    <h4>
                      <a class="toc-backref" href="#id41" role="doc-backlink"
                        >cephadm_ssh_user</a
                      ><a
                        class="headerlink"
                        href="#cephadm-ssh-user"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The ssh username on remote hosts that will be used by
                          <code class="docutils literal notranslate"
                            ><span class="pre">cephadm</span></code
                          >.
                        </p>
                      </dd>
                    </dl>
                  </section>
                  <section id="cephadm-pubkey-path">
                    <h4>
                      <a class="toc-backref" href="#id42" role="doc-backlink"
                        >cephadm_pubkey_path</a
                      ><a
                        class="headerlink"
                        href="#cephadm-pubkey-path"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          Full path name of the ssh public key file
                          <strong>on the ansible controller host</strong>.
                        </p>
                      </dd>
                    </dl>
                  </section>
                </section>
              </section>
              <section id="cephadm-purge">
                <h2>
                  <a class="toc-backref" href="#id43" role="doc-backlink"
                    >cephadm-purge</a
                  ><a
                    class="headerlink"
                    href="#cephadm-purge"
                    title="Link to this heading"
                    >¶</a
                  >
                </h2>
                <p>This playbook purges a Ceph cluster managed with cephadm</p>
                <p>
                  You must define a group
                  <code class="docutils literal notranslate"
                    ><span class="pre">[admin]</span></code
                  >
                  in your inventory with a node where the admin keyring is
                  present at
                  <code class="docutils literal notranslate"
                    ><span class="pre"
                      >/etc/ceph/ceph.client.admin.keyring</span
                    ></code
                  >
                </p>
                <p>Usage:</p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">inventory</span> <span class="n">host</span> <span class="n">file</span><span class="o">&gt;</span> <span class="n">cephadm</span><span class="o">-</span><span class="n">purge</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yml</span> <span class="o">-</span><span class="n">e</span> <span class="n">fsid</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">fsid</span><span class="o">&gt;</span>
</pre>
                  </div>
                </div>
                <section id="id4">
                  <h3>
                    <a class="toc-backref" href="#id44" role="doc-backlink"
                      >Options</a
                    ><a
                      class="headerlink"
                      href="#id4"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <section id="id5">
                    <h4>
                      <a class="toc-backref" href="#id45" role="doc-backlink"
                        >fsid</a
                      ><a
                        class="headerlink"
                        href="#id5"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd><p>The fsid of the cluster.</p></dd>
                    </dl>
                  </section>
                </section>
              </section>
              <section id="cephadm-clients">
                <h2>
                  <a class="toc-backref" href="#id46" role="doc-backlink"
                    >cephadm-clients</a
                  ><a
                    class="headerlink"
                    href="#cephadm-clients"
                    title="Link to this heading"
                    >¶</a
                  >
                </h2>
                <p>
                  If you plan to deploy client nodes, you must define a group
                  called “clients” in your inventory:
                </p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span>$ cat hosts
node1
node2
node3

[clients]
client1
client2
client3
node123
</pre>
                  </div>
                </div>
                <p>
                  This playbooks distribute keyring and conf files to a set of
                  client hosts.
                </p>
                <p>Usage:</p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">inventory</span> <span class="n">host</span> <span class="n">file</span><span class="o">&gt;</span> <span class="n">cephadm</span><span class="o">-</span><span class="n">clients</span><span class="o">.</span><span class="n">yml</span> <span class="o">-</span><span class="n">e</span> <span class="n">fsid</span><span class="o">=&lt;</span><span class="n">cluster</span> <span class="n">fsid</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">e</span> <span class="n">keyring</span><span class="o">=&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">keyring</span><span class="o">&gt;</span>
</pre>
                  </div>
                </div>
                <section id="id6">
                  <h3>
                    <a class="toc-backref" href="#id47" role="doc-backlink"
                      >Options</a
                    ><a
                      class="headerlink"
                      href="#id6"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <section id="keyring">
                    <h4>
                      <a class="toc-backref" href="#id48" role="doc-backlink"
                        >keyring</a
                      ><a
                        class="headerlink"
                        href="#keyring"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The full path name of the keyring file on the host
                          (which should be admin[0]) which holds the key for the
                          client to use
                        </p>
                      </dd>
                    </dl>
                  </section>
                  <section id="conf">
                    <h4>
                      <a class="toc-backref" href="#id49" role="doc-backlink"
                        >conf</a
                      ><a
                        class="headerlink"
                        href="#conf"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The full path name of the conf file on the (which
                          should be admin[0]) host to use (undefined will
                          trigger a minimal conf)
                        </p>
                      </dd>
                    </dl>
                  </section>
                  <section id="keyring-dest">
                    <h4>
                      <a class="toc-backref" href="#id50" role="doc-backlink"
                        >keyring_dest</a
                      ><a
                        class="headerlink"
                        href="#keyring-dest"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The full path name of the destination where the
                          keyring will be copied on the remote host. (default:
                          /etc/ceph/ceph.keyring)
                        </p>
                      </dd>
                    </dl>
                  </section>
                </section>
              </section>
              <section id="rocksdb-resharding">
                <h2>
                  <a class="toc-backref" href="#id51" role="doc-backlink"
                    >rocksdb-resharding</a
                  ><a
                    class="headerlink"
                    href="#rocksdb-resharding"
                    title="Link to this heading"
                    >¶</a
                  >
                </h2>
                <p>
                  This playbook reshards the rocksDB database for a given OSD.
                </p>
                <p>Usage:</p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">inventory</span> <span class="n">host</span> <span class="n">file</span><span class="o">&gt;</span> <span class="n">rocksdb</span><span class="o">-</span><span class="n">resharding</span><span class="o">.</span><span class="n">yml</span> <span class="o">-</span><span class="n">e</span> <span class="n">osd_id</span><span class="o">=</span><span class="mi">0</span> <span class="o">-</span><span class="n">e</span> <span class="n">admin_node</span><span class="o">=</span><span class="n">ceph</span><span class="o">-</span><span class="n">mon0</span> <span class="o">-</span><span class="n">e</span> <span class="n">rocksdb_sharding_parameters</span><span class="o">=</span><span class="s1">&#39;m(3) p(3,0-12) O(3,0-13) L P&#39;</span>
</pre>
                  </div>
                </div>
                <section id="id7">
                  <h3>
                    <a class="toc-backref" href="#id52" role="doc-backlink"
                      >Options</a
                    ><a
                      class="headerlink"
                      href="#id7"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <section id="id8">
                    <h4>
                      <a class="toc-backref" href="#id53" role="doc-backlink"
                        >fsid</a
                      ><a
                        class="headerlink"
                        href="#id8"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd><p>The fsid of the Ceph cluster.</p></dd>
                    </dl>
                  </section>
                  <section id="osd-id">
                    <h4>
                      <a class="toc-backref" href="#id54" role="doc-backlink"
                        >osd_id</a
                      ><a
                        class="headerlink"
                        href="#osd-id"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The id of the OSD where you want to reshard its
                          corresponding rocksdb database.
                        </p>
                      </dd>
                    </dl>
                  </section>
                  <section id="id9">
                    <h4>
                      <a class="toc-backref" href="#id55" role="doc-backlink"
                        >admin_node</a
                      ><a
                        class="headerlink"
                        href="#id9"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The name of a node with enough privileges to
                          stop/start daemons via
                          <cite>cephadm shell ceph orch daemon</cite> command.
                          (Usually the bootstrap node)
                        </p>
                      </dd>
                    </dl>
                  </section>
                  <section id="rocksdb-sharding-parameters">
                    <h4>
                      <a class="toc-backref" href="#id56" role="doc-backlink"
                        >rocksdb_sharding_parameters</a
                      ><a
                        class="headerlink"
                        href="#rocksdb-sharding-parameters"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <dl class="simple">
                      <dt><strong>description</strong></dt>
                      <dd>
                        <p>
                          The rocksdb sharding parameter to set. Default is
                          ‘m(3) p(3,0-12) O(3,0-13) L P’.
                        </p>
                      </dd>
                    </dl>
                  </section>
                  <section id="docker">
                    <h4>
                      <a class="toc-backref" href="#id57" role="doc-backlink"
                        >docker</a
                      ><a
                        class="headerlink"
                        href="#docker"
                        title="Link to this heading"
                        >¶</a
                      >
                    </h4>
                    <blockquote>
                      <div>
                        <p>
                          A boolean to be set in order to tell the playbook
                          cephadm uses
                          <code class="docutils literal notranslate"
                            ><span class="pre">docker</span></code
                          >
                          instead of
                          <code class="docutils literal notranslate"
                            ><span class="pre">podman</span></code
                          >
                          as container engine. Default is
                          <code class="docutils literal notranslate"
                            ><span class="pre">False</span></code
                          >.
                        </p>
                      </div>
                    </blockquote>
                  </section>
                </section>
              </section>
            </section>
            <section id="modules">
              <h1>
                <a class="toc-backref" href="#id58" role="doc-backlink"
                  >Modules</a
                ><a
                  class="headerlink"
                  href="#modules"
                  title="Link to this heading"
                  >¶</a
                >
              </h1>
              <section id="id10">
                <h2>
                  <a class="toc-backref" href="#id59" role="doc-backlink"
                    >Introduction</a
                  ><a
                    class="headerlink"
                    href="#id10"
                    title="Link to this heading"
                    >¶</a
                  >
                </h2>
                <p>
                  cephadm-ansible provides several modules to make it easier to
                  write playbooks around cephadm/ceph orch. The idea is to let
                  you write your own playbooks, rather than providing a unique
                  playbook that would try to cover anyone’s use case. This way
                  you can have a solution that fits better with your needs.
                </p>
                <p>
                  At the moment only the most important tasks are supported.
                  This means that any operation not covered would have to be
                  done either with either the
                  <code class="docutils literal notranslate"
                    ><span class="pre">command</span></code
                  >
                  or
                  <code class="docutils literal notranslate"
                    ><span class="pre">shell</span></code
                  >
                  Ansible tasks in your playbook.
                </p>
              </section>
              <section id="module-descriptions">
                <h2>
                  <a class="toc-backref" href="#id60" role="doc-backlink"
                    >Module descriptions</a
                  ><a
                    class="headerlink"
                    href="#module-descriptions"
                    title="Link to this heading"
                    >¶</a
                  >
                </h2>
                <section id="cephadm-bootstrap">
                  <h3>
                    <a class="toc-backref" href="#id61" role="doc-backlink"
                      >cephadm_bootstrap</a
                    ><a
                      class="headerlink"
                      href="#cephadm-bootstrap"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <dl class="simple">
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">mon_ip</span></code
                      >
                    </dt>
                    <dd><p>Ceph monitor IP address.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">image</span></code
                      >
                    </dt>
                    <dd><p>Ceph container image.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">docker</span></code
                      >
                    </dt>
                    <dd><p>Use docker instead of podman.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">fsid</span></code
                      >
                    </dt>
                    <dd><p>Ceph FSID.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">pull</span></code
                      >
                    </dt>
                    <dd><p>Pull the Ceph container image.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">dashboard</span></code
                      >
                    </dt>
                    <dd><p>Deploy the Ceph dashboard.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">dashboard_user</span></code
                      >
                    </dt>
                    <dd><p>Ceph dashboard user.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">dashboard_password</span></code
                      >
                    </dt>
                    <dd><p>Ceph dashboard password.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">monitoring</span></code
                      >
                    </dt>
                    <dd><p>Deploy the monitoring stack.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">firewalld</span></code
                      >
                    </dt>
                    <dd><p>Manage firewall rules with firewalld.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">allow_overwrite</span></code
                      >
                    </dt>
                    <dd>
                      <p>
                        allow overwrite of existing -output-* config/keyring/ssh
                        files.
                      </p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">registry_url</span></code
                      >
                    </dt>
                    <dd><p>URL for custom registry.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">registry_username</span></code
                      >
                    </dt>
                    <dd><p>Username for custom registry.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">registry_password</span></code
                      >
                    </dt>
                    <dd><p>Password for custom registry.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">registry_json</span></code
                      >
                    </dt>
                    <dd>
                      <p>
                        JSON file with custom registry login info (URL,
                        username, password).
                      </p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">ssh_user</span></code
                      >
                    </dt>
                    <dd><p>SSH user used for cephadm ssh to the hosts.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">ssh_config</span></code
                      >
                    </dt>
                    <dd><p>SSH config file path for cephadm ssh client.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">allow_fqdn_hostname</span></code
                      >
                    </dt>
                    <dd><p>Allow hostname that is fully-qualified.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">cluster_network</span></code
                      >
                    </dt>
                    <dd>
                      <p>
                        Subnet to use for cluster replication, recovery and
                        heartbeats.
                      </p>
                    </dd>
                  </dl>
                </section>
                <section id="ceph-orch-host">
                  <h3>
                    <a class="toc-backref" href="#id62" role="doc-backlink"
                      >ceph_orch_host</a
                    ><a
                      class="headerlink"
                      href="#ceph-orch-host"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <dl class="simple">
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">fsid</span></code
                      >
                    </dt>
                    <dd>
                      <p>The fsid of the Ceph cluster to interact with.</p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">image</span></code
                      >
                    </dt>
                    <dd><p>Ceph container image.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">name</span></code
                      >
                    </dt>
                    <dd>
                      <p>name of the host to be added/removed/updated.</p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">address</span></code
                      >
                    </dt>
                    <dd>
                      <p>
                        address of the host, required when
                        <code class="docutils literal notranslate"
                          ><span class="pre">state</span></code
                        >
                        is
                        <code class="docutils literal notranslate"
                          ><span class="pre">present</span></code
                        >.
                      </p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">set_admin_label</span></code
                      >
                    </dt>
                    <dd>
                      <p>
                        enforce ‘_admin’ label on the host specified in ‘name’.
                      </p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">labels</span></code
                      >
                    </dt>
                    <dd><p>list of labels to apply on the host.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">state</span></code
                      >
                    </dt>
                    <dd>
                      <p>
                        If set to ‘present’, it will ensure the host specified
                        in ‘name’ will be present along with the labels
                        specified in
                        <code class="docutils literal notranslate"
                          ><span class="pre">labels</span></code
                        >. If set to ‘absent’, it will remove the host specified
                        in ‘name’. If set to ‘drain’, it will schedule to remove
                        all daemons from the host specified in ‘name’.
                      </p>
                    </dd>
                  </dl>
                </section>
                <section id="ceph-config">
                  <h3>
                    <a class="toc-backref" href="#id63" role="doc-backlink"
                      >ceph_config</a
                    ><a
                      class="headerlink"
                      href="#ceph-config"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <dl class="simple">
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">fsid</span></code
                      >
                    </dt>
                    <dd>
                      <p>The fsid of the Ceph cluster to interact with.</p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">image</span></code
                      >
                    </dt>
                    <dd><p>Ceph container image.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">action</span></code
                      >
                    </dt>
                    <dd>
                      <p>
                        Whether to get or set the parameter specified in
                        ‘option’.
                      </p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">who</span></code
                      >
                    </dt>
                    <dd>
                      <p>Which daemon the configuration should be set to.</p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">option</span></code
                      >
                    </dt>
                    <dd><p>Name of the parameter to be set.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">value</span></code
                      >
                    </dt>
                    <dd><p>Value of the parameter to set.</p></dd>
                  </dl>
                </section>
                <section id="ceph-orch-apply">
                  <h3>
                    <a class="toc-backref" href="#id64" role="doc-backlink"
                      >ceph_orch_apply</a
                    ><a
                      class="headerlink"
                      href="#ceph-orch-apply"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <dl class="simple">
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">fsid</span></code
                      >
                    </dt>
                    <dd>
                      <p>The fsid of the Ceph cluster to interact with.</p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">image</span></code
                      >
                    </dt>
                    <dd><p>Ceph container image.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">spec</span></code
                      >
                    </dt>
                    <dd><p>The service spec to apply.</p></dd>
                  </dl>
                </section>
                <section id="ceph-orch-daemon">
                  <h3>
                    <a class="toc-backref" href="#id65" role="doc-backlink"
                      >ceph_orch_daemon</a
                    ><a
                      class="headerlink"
                      href="#ceph-orch-daemon"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <dl class="simple">
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">fsid</span></code
                      >
                    </dt>
                    <dd>
                      <p>The fsid of the Ceph cluster to interact with.</p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">image</span></code
                      >
                    </dt>
                    <dd><p>Ceph container image.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">state</span></code
                      >
                    </dt>
                    <dd>
                      <p>
                        The desired state of the service specified in ‘name’. If
                        ‘started’, it ensures the service is started. If
                        ‘stopped’, it ensures the service is stopped. If
                        ‘restarted’, it will restart the service.
                      </p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">daemon_id</span></code
                      >
                    </dt>
                    <dd><p>The id of the service.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">daemon_type</span></code
                      >
                    </dt>
                    <dd><p>The type of the service.</p></dd>
                  </dl>
                </section>
                <section id="cephadm-registry-login">
                  <h3>
                    <a class="toc-backref" href="#id66" role="doc-backlink"
                      >cephadm_registry_login</a
                    ><a
                      class="headerlink"
                      href="#cephadm-registry-login"
                      title="Link to this heading"
                      >¶</a
                    >
                  </h3>
                  <dl class="simple">
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">state</span></code
                      >
                    </dt>
                    <dd>
                      <p>
                        Whether the module should log in to the registry or log
                        out.
                      </p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">registry_url</span></code
                      >
                    </dt>
                    <dd><p>The container registry to log in or log out.</p></dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">registry_username</span></code
                      >
                    </dt>
                    <dd>
                      <p>The username to log in to the container registry.</p>
                    </dd>
                    <dt>
                      <code class="docutils literal notranslate"
                        ><span class="pre">registry_password</span></code
                      >
                    </dt>
                    <dd>
                      <p>
                        The corresponding password to be used with
                        <code class="docutils literal notranslate"
                          ><span class="pre">registry_username</span></code
                        >.
                      </p>
                    </dd>
                  </dl>
                </section>
              </section>
              <section id="samples">
                <h2>
                  <a class="toc-backref" href="#id67" role="doc-backlink"
                    >Samples</a
                  ><a
                    class="headerlink"
                    href="#samples"
                    title="Link to this heading"
                    >¶</a
                  >
                </h2>
                <p>
                  This shows how the supported modules can be used in a
                  playbook. This doesn’t cover the pre-requisites steps
                  (preflight, …) so it implies all requirements are satisfied
                  (podman, lvm2,…). It assumes your “bootstrap host” (or “admin
                  host”) can ssh to other hosts with root user without password.
                </p>
                <p>Bootstrap and add some hosts:</p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="c1"># cat hosts</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">mon1</span> <span class="n">monitor_address</span><span class="o">=</span><span class="mf">10.10.10.101</span> <span class="n">labels</span><span class="o">=</span><span class="s2">&quot;[&#39;_admin&#39;, &#39;mon&#39;, &#39;mgr&#39;]&quot;</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">mon2</span> <span class="n">labels</span><span class="o">=</span><span class="s2">&quot;[&#39;mon&#39;, &#39;mgr&#39;]&quot;</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">mon3</span> <span class="n">labels</span><span class="o">=</span><span class="s2">&quot;[&#39;mon&#39;, &#39;mgr&#39;]&quot;</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">osd1</span> <span class="n">labels</span><span class="o">=</span><span class="s2">&quot;[&#39;osd&#39;]&quot;</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">osd2</span> <span class="n">labels</span><span class="o">=</span><span class="s2">&quot;[&#39;osd&#39;]&quot;</span>
<span class="n">ceph</span><span class="o">-</span><span class="n">osd3</span> <span class="n">labels</span><span class="o">=</span><span class="s2">&quot;[&#39;osd&#39;]&quot;</span>
<span class="c1"># cat site.yml</span>
<span class="o">---</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">bootstrap</span> <span class="n">the</span> <span class="n">cluster</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="n">ceph</span><span class="o">-</span><span class="n">mon1</span>
  <span class="n">become</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">gather_facts</span><span class="p">:</span> <span class="n">false</span>
  <span class="n">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">login</span> <span class="n">to</span> <span class="n">quay</span><span class="o">.</span><span class="n">io</span> <span class="n">registry</span>
      <span class="n">cephadm_registry_login</span><span class="p">:</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">login</span>
        <span class="n">registry_url</span><span class="p">:</span> <span class="n">quay</span><span class="o">.</span><span class="n">io</span>
        <span class="n">registry_username</span><span class="p">:</span> <span class="n">foo</span>
        <span class="n">registry_password</span><span class="p">:</span> <span class="n">b4r</span>

    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">bootstrap</span> <span class="n">initial</span> <span class="n">cluster</span>
      <span class="n">cephadm_bootstrap</span><span class="p">:</span>
        <span class="n">mon_ip</span><span class="p">:</span> <span class="s2">&quot;{{ monitor_address }}&quot;</span>

<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">add</span> <span class="n">more</span> <span class="n">hosts</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="nb">all</span>
  <span class="n">become</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">gather_facts</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">add</span> <span class="n">hosts</span> <span class="n">to</span> <span class="n">the</span> <span class="n">cluster</span>
      <span class="n">ceph_orch_host</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;{{ ansible_facts[&#39;hostname&#39;] }}&quot;</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;{{ ansible_facts[&#39;default_ipv4&#39;][&#39;address&#39;] }}&quot;</span>
        <span class="n">labels</span><span class="p">:</span> <span class="s2">&quot;{{ labels }}&quot;</span>
      <span class="n">delegate_to</span><span class="p">:</span> <span class="n">ceph</span><span class="o">-</span><span class="n">mon1</span>

<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">deploy</span> <span class="n">osd</span> <span class="n">service</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="n">ceph</span><span class="o">-</span><span class="n">mon1</span>
  <span class="n">become</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">gather_facts</span><span class="p">:</span> <span class="n">false</span>
  <span class="n">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">apply</span> <span class="n">osd</span> <span class="n">spec</span>
      <span class="n">ceph_orch_apply</span><span class="p">:</span>
      <span class="n">spec</span><span class="p">:</span> <span class="o">|</span>
        <span class="n">service_type</span><span class="p">:</span> <span class="n">osd</span>
        <span class="n">service_id</span><span class="p">:</span> <span class="n">osd</span>
        <span class="n">placement</span><span class="p">:</span>
          <span class="n">host_pattern</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span>
          <span class="n">label</span><span class="p">:</span> <span class="n">osd</span>
        <span class="n">spec</span><span class="p">:</span>
          <span class="n">data_devices</span><span class="p">:</span>
            <span class="nb">all</span><span class="p">:</span> <span class="n">true</span>

<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">change</span> <span class="n">osd_default_notify_timeout</span> <span class="n">option</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="n">ceph</span><span class="o">-</span><span class="n">mon1</span>
  <span class="n">become</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">gather_facts</span><span class="p">:</span> <span class="n">false</span>
  <span class="n">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">decrease</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">osd_default_notify_timeout</span> <span class="n">option</span>
      <span class="n">ceph_config</span><span class="p">:</span>
        <span class="n">action</span><span class="p">:</span> <span class="nb">set</span>
        <span class="n">who</span><span class="p">:</span> <span class="n">osd</span>
        <span class="n">option</span><span class="p">:</span> <span class="n">osd_default_notify_timeout</span>
        <span class="n">value</span><span class="p">:</span> <span class="mi">20</span>
</pre>
                  </div>
                </div>
                <div class="admonition note">
                  <p class="admonition-title">Note</p>
                  <p>
                    You may have noticed that most of the time, the target node
                    in the different plays in the playbook above is
                    <code class="docutils literal notranslate"
                      ><span class="pre">ceph-mon1</span></code
                    >, which is the bootstrap node.
                  </p>
                </div>
              </section>
            </section>
            <section id="upcoming-changes">
              <h1>
                <a class="toc-backref" href="#id68" role="doc-backlink"
                  >Upcoming changes</a
                ><a
                  class="headerlink"
                  href="#upcoming-changes"
                  title="Link to this heading"
                  >¶</a
                >
              </h1>
              <div class="admonition important">
                <p class="admonition-title">Important</p>
                <p>The name of the project might change in the next release.</p>
              </div>
              <div class="admonition important">
                <p class="admonition-title">Important</p>
                <p>
                  In the next release, this project will be distributed as an
                  Ansible collection.
                </p>
              </div>
            </section>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
          <h1 class="logo"><a href="#">cephadm-ansible</a></h1>

          <h3>Navigation</h3>

          <div class="relations">
            <h3>Related Topics</h3>
            <ul>
              <li>
                <a href="#">Documentation overview</a>
                <ul></ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Red Hat. | Powered by
      <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a> &amp;
      <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
    </div>
  </body>
</html>

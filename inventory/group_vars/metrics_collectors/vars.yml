---
vault_pihole_api_token: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  38396331613837376233323337343630626236313566613537396266333136393231643532323065
  3363343539623734343838613730346465376363363162320a383766653063636639626335623861
  65646436613337363337323066616330306632643537613631663733316534386464376234656265
  6432666339396165620a643861366563653830373834323263323731313137643338393532373737
  33326439393266323365366663373236393338656664346663666334303361383061376364333534
  34333835316337633831363037343734626366636361363635343232333163366635663563366362
  63633564386562613732363534386461303861666336633739396463383436366537313233363665
  63373761366565613865
vault_influxdb2_pihole2_token: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  61633839366332366236666334336431633363333837343637633233306236393335646230653664
  3565373366633232356339643539393836646537346435660a343964396165376362396666373166
  37366361373533653465303738646330346563353336666439323734363533653064663536343763
  3764396238303139620a613365313337383936393234373165363436303438376133663666386436
  37366336363630613637333439313165616432616364366336643336323938623030643966373930
  37653533383431343865636537333962303631343339353566323430663137313431373036323465
  34386532353961306331363861383361373632653462383662313963643930373161383033646530
  65643138396334663962303261323061616634663935373335666434663763343539636231393730
  6533
vault_pihole_influxdb2_token: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  62363364343064333735376565643630353939633037623933643262323333633130343030663166
  6637393262336564633363633465626631366137396536610a623630303065323830653530616230
  37383263663738643663633261336338363135653133373138613933623230656133386531336636
  6530326136316337650a636166346163396339653430336663666236356233366161316237333364
  65663532343436356636316639396233663363363334643636313730656136306235336163633462
  30666138656538646565353866613235356666326135643231383465346261353162366365393832
  38353237636638323262643764393232633138353632313064656461613236323237656339346136
  36323161386366306161386333643263326531343831303039366633313931333161373432333161
  3364
vault_influxdb2_org_id: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  35326265333630646334643531653032653232343265393331613034336265356263336465386564
  6362656536613064386263353335386561656439396338350a613631303632303436666138366332
  32353664393038633034356238666163346439643763313036313261373362326531336637306139
  3966636161633830650a636235356263646439663637336536346161373162633236623330663837
  37353738616536633433633337323837613862623139323637373231306339306239
vault_adguard_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  33643564656330333630366263626363626562656332666435623034373835616135643533653736
  3032383935653234643765306265646365393430383162300a306364396564346631303135636364
  65636436393234613762396362666439383538363466633466653735643962636465633834353931
  6131663366333239300a353335623433643632663565663833393437626534323763303664666130
  36336332346138643036656230643661623461653532663862336562613661613638
vault_unpoller_influxdb_pass: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  37306132306533626534663236626461656335316162326331666231373364326530376237396233
  3735633365633331383733326537333838323465636231640a363338633364383062373964386235
  65313238396163613636356331643838623733366665313730313761316538326236366133393063
  3366656638616664620a373139663633343234626561626636383362333364303633373339666661
  6466
vault_unpoller_influxdb_token: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  39313030363264306234636361303032396362636161376663393438656437613264313135336630
  3263663766663166363264343161323236373062383631320a303163313063393935316361396536
  35363834396535356130316361333031623365356261623063306365316132656632643863663166
  3832306531633332310a383735346437363530336163666164353938633363656237396466393438
  34636165613430363865653336383135666661623638366338356266623933376437643539353266
  66666630323866653935303362393934653162616338393734653832626261386266396436366665
  61323231303164326537343339653362633461373164623634656430653865633932633039653430
  64366235346230373731633938366330356532383637313238346439326666653365663133393039
  3265
docker_install_community_edition: true

unpoller_image_tag: latest

docker_compose_projects:
  - project_name: metrics
    pull: "{{ docker_recreate | default(False) }}"
    build: "{{ docker_recreate | default(False) }}"
    nocache: "{{ docker_recreate | default(False) }}"
    recreate: "{{ docker_recreate | default(False) }}"
    remove_orphans: "{{ docker_recreate | default(False) }}"
    definition:
      version: "3.9"
      x-logging: &default-logging
        driver: journald
      services:
        pihole-influxdb:
          image: avojak/pihole-influxdb:latest
          container_name: pihole-influxdb
          hostname: pihole-influxdb
          restart: unless-stopped
          privileged: true
          network_mode: host
          environment:
            PIHOLE_ALIAS: dns01
            PIHOLE_ADDRESS: http://10.0.10.222
            PIHOLE_TOKEN: "{{ vault_pihole_api_token }}"
            INFLUXDB_ADDRESS: http://10.0.10.17:8086
            INFLUXDB_ORG: constructorfleet
            INFLUXDB_TOKEN: "{{ vault_influxdb2_pihole2_token }}"
            INFLUXDB_BUCKET: pihole2
            INFLUXDB_CREATE_BUCKET: "True"
            INFLUXDB_VERIFY_SSL: "False"
          volumes:
            - /opt/pihole-influxdb/conf:/etc/pihole-influxdb/config
          logging:
            <<: *default-logging
            options:
              tag: pihole-influxdb
        unpoller:
          hostname: unpoller
          privileged: true
          container_name: unpoller
          restart: unless-stopped
          network_mode: host
          image: ghcr.io/unpoller/unpoller:{{ unpoller_image_tag }}
          environment:
            UP_INFLUXDB_DB: unifiv2
            UP_INFLUXDB_USER: unpoller
            UP_INFLUXDB_PASS: "{{ vault_unpoller_influxdb_pass }}"
            UP_INFLUXDB_ORG: constructorfleet
            UP_INFLUXDB_BUCKET: unifiv2
            UP_INFLUXDB_AUTH_TOKEN: "{{ vault_unpoller_influxdb_token }}"
            UP_INFLUXDB_URL: http://10.0.10.17:8086
            UP_UNIFI_DEFAULT_USER: automation
            UP_UNIFI_DEFAULT_PASS: "{{ vault_unifi_automation_pass }}"
            UP_UNIFI_DEFAULT_URL: https://192.168.1.175
            UP_POLLER_DEBUG: "true"
            UP_UNIFI_DEFAULT_SAVE_SITES: "true"
            UP_UNIFI_DEFAULT_SAVE_ANOMALIES: "true"
            UP_UNIFI_DEFAULT_SAVE_IDS: "false"
            UP_UNIFI_DEFAULT_SAVE_DPI: "true"
            UP_PROMETHEUS_DISABLE: "false"
          volumes:
            - /opt/unpoller/conf:/etc/unifi-poller
          logging:
            <<: *default-logging
            options:
              tag: unpoller

# ADDITIONAL TELEGRAF INPUT PLUGINS
telegraf_plugins_extra:
  - name: docker
    options:
      endpoint: unix:///var/run/docker.sock
      timeout: 5s
      perdevice: "true"
      total: "true"
  - name: prometheus
    options:
      urls:
        - http://localhost:9617/metrics
      metric_version: 2
      name_override: pihole
  - name: docker_log
    options:
      endpoint: unix:///var/run/docker.sock
      timeout: 5s
      source_tag: "true"

vault_unifi_automation_pass: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  63323363613839306630643034373338373064316463393634336664653064613431316166373337
  6164313764666134303638356363383665646338626464300a326439333033336466383334326335
  38663332336538303132323665613166366334653364613965636236353537613832393930663865
  3763653333313064340a353931356566616561386631613266316234633634393738356631313462
  6466
